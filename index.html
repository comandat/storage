<!DOCTYPE html>
<html class="dark" lang="ro">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>Manager Stocuri</title>
    
    <!-- Fonturi și Iconițe -->
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    
    <!-- Configurare Tailwind -->
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#007AFF",
                        "background-light": "#F3F4F6",
                        "background-dark": "#0B1117",
                        "card-light": "#FFFFFF",
                        "card-dark": "#161D26",
                        "text-light": "#111827",
                        "text-dark": "#E5E7EB",
                        "subtext-light": "#6B7280",
                        "subtext-dark": "#9CA3AF",
                    },
                    fontFamily: {
                        display: ["Sora", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "1rem",
                        "2xl": "1.5rem",
                        "3xl": "2rem",
                    },
                    boxShadow: {
                        'glow-primary': '0 0 20px 0px rgba(0, 122, 255, 0.4)',
                    }
                },
            },
        };
    </script>
    
    <!-- CSS Personalizat -->
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-background-light dark:bg-background-dark font-display antialiased">

    <!-- Containerul principal al aplicației -->
    <div id="app-container" class="max-w-md mx-auto">
    
        <!-- PAGINA 1: Dashboard (Acasă) -->
        <div id="page-dashboard" class="page active p-6">
            <header class="flex items-center justify-center py-4 relative">
                <h1 class="text-xl font-semibold text-text-light dark:text-text-dark">Depozit</h1>
            </header>

            <!-- Zona de Căutare Integrată (ACUM PRIMA) -->
            <div id="search-zone" class="mb-6 mt-6">
                <div id="search-container">
                    <form id="search-form" class="dark:bg-card-dark shadow-sm" onsubmit="event.preventDefault();">
                        <span id="search-icon" class="material-icons-outlined">search</span>
                        <input type="text" id="search-input" placeholder="Caută produs..." class="dark:text-text-dark dark:placeholder-subtext-dark">
                    </form>
                </div>
                
                <!-- Butonul "Căută după QR" (mărit) -->
                <button id="scan-find-button" onclick="startScanner('find')" class="w-full bg-primary text-white font-bold py-5 rounded-xl flex items-center justify-center space-x-2 text-lg mt-4 shadow-lg shadow-primary/30 dark:shadow-glow-primary transition-all duration-300">
                    <span class="material-icons-outlined">qr_code_scanner</span>
                    <span>Căută după QR</span>
                </button>

                <!-- Rezultate Căutare (ascunse inițial) -->
                <div id="find-results" class="space-y-4 mt-4 hidden">
                    <!-- Rezultatele căutării vor fi injectate aici -->
                </div>
            </div>

            <!-- Cardurile principale (vor fi ascunse la căutare) -->
            <main id="main-cards" class="flex-grow flex flex-col space-y-5 mt-6">
                <a class="group block p-8 bg-card-light dark:bg-card-dark rounded-3xl transition-all duration-300 hover:scale-[1.03] hover:shadow-xl dark:hover:bg-card-dark/80" href="#" onclick="showPage('page-add-product')">
                    <div class="flex items-center space-x-6">
                        <div class="p-4 rounded-2xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center transition-colors">
                            <span class="material-icons-outlined text-4xl text-text-light dark:text-text-dark">add_location_alt</span>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-text-light dark:text-text-dark">Adaugă Produs</h3>
                            <p class="text-sm text-subtext-light dark:text-subtext-dark mt-1">Asociază un produs cu o locație</p>
                        </div>
                    </div>
                </a>
                
                <!-- Card NOU: Mută Produs -->
                <a class="group block p-8 bg-card-light dark:bg-card-dark rounded-3xl transition-all duration-300 hover:scale-[1.03] hover:shadow-xl dark:hover:bg-card-dark/80" href="#" onclick="showPage('page-move-product')">
                    <div class="flex items-center space-x-6">
                        <div class="p-4 rounded-2xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center transition-colors">
                            <span class="material-icons-outlined text-4xl text-text-light dark:text-text-dark">compare_arrows</span>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-text-light dark:text-text-dark">Mută Produs</h3>
                            <p class="text-sm text-subtext-light dark:text-subtext-dark mt-1">Mută stocul între locații</p>
                        </div>
                    </div>
                </a>
            </main>
        </div>

        <!-- PAGINA 2: Căutare / Găsire Produs (Goală) -->
        <div id="page-find-product" class="page"></div>

        <!-- PAGINA 3: Adaugă Produs la Locație -->
        <div id="page-add-product" class="page p-6 relative">
            <button onclick="showPage('page-dashboard')" class="absolute top-6 right-6 p-2 text-subtext-light dark:text-subtext-dark z-10">
                <span class="material-icons-outlined text-3xl">close</span>
            </button>
            
            <!-- Pasul 1: Scanare Produse (Interfață nouă) -->
            <div id="add-step-1-products" class="animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 1: Scanează Produsele</h2>
                <p class="text-subtext-light dark:text-subtext-dark mb-6 text-center">Scanează unul sau mai multe produse pe care vrei să le adaugi. Fiecare scanare adaugă o bucată.</p>
                
                <!-- Lista de produse scanate -->
                <div id="add-product-list" class="space-y-2 mb-4 max-h-60 overflow-y-auto">
                    <!-- Produsele scanate vor fi injectate aici -->
                </div>

                <button onclick="startScanner('product')" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg shadow-primary/30 dark:shadow-glow-primary mb-4">
                    <span class="material-icons-outlined">qr_code_scanner</span>
                    <span>Scanează Produs (SKU)</span>
                </button>
                <button id="add-to-location-btn" onclick="goToAddStep(2)" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg hidden">
                    <span>Mergi la Locație</span>
                    <span class="material-icons-outlined">arrow_forward</span>
                </button>
            </div>

            <!-- Pasul 2: Scanare Locație (Modificat) -->
            <div id="add-step-2-location" class="hidden animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 2: Scanează Locația</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-6 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Produse de adăugat:</p>
                    <div id="add-product-summary" class="text-text-light dark:text-text-dark font-semibold text-lg">...</div>
                </div>

                <p class="text-subtext-light dark:text-subtext-dark mb-6 text-center">Acum scanează codul QR al locației (ex: "1,2,3").</p>
                <button onclick="startScanner('location')" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg shadow-primary/30 dark:shadow-glow-primary">
                    <span class="material-icons-outlined">pin_drop</span>
                    <span>Scanează Locație</span>
                </button>
                <button onclick="goToAddStep(1)" class="w-full text-center text-primary mt-6">
                    Modifică Produsele
                </button>
            </div>

            <!-- Pasul 3: Confirmare (Înlocuiește Cantitatea) -->
            <div id="add-step-3-confirm" class="hidden animate-slide-in mt-8 flex flex-col h-full" style="min-height: 70vh;">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 3: Confirmă Adăugarea</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-4 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Produse:</p>
                    <ul id="add-confirm-list" class="text-text-light dark:text-text-dark font-semibold text-lg list-disc list-inside text-left p-2">
                        <!-- Sumar produse -->
                    </ul>
                </div>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-6 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Locație:</p>
                    <div id="add-confirm-location" class="text-text-light dark:text-text-dark font-semibold text-lg">...</div>
                </div>

                <!-- Spacer -->
                <div class="flex-grow"></div>
                
                <!-- Butoane acțiune jos -->
                <div class="mt-auto pt-6">
                    <button onclick="saveMultiAdd()" class="w-full bg-green-600 text-white font-bold py-5 rounded-2xl flex items-center justify-center space-x-2 text-xl shadow-lg mb-4">
                        <span class="material-icons-outlined">check_circle</span>
                        <span>Salvează</span>
                    </button>
                    <div class="flex space-x-4">
                         <button onclick="goToAddStep(2)" class="w-full text-center text-primary py-2">
                            Schimbă Locația
                        </button>
                        <button onclick="goToAddStep(1)" class="w-full text-center text-primary py-2">
                            Modifică Produsele
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGINA 4: Flux de Picking (UI Modificat) -->
        <div id="page-picking" class="page p-6 relative">
            <!-- Header nou (doar 'X') -->
            <header class="flex items-center justify-end py-4 relative">
                <button onclick="showPage('page-dashboard')" class="p-2 text-subtext-light dark:text-subtext-dark z-10">
                    <span class="material-icons-outlined text-3xl">close</span>
                </button>
            </header>
            
            <div id="picking-content">
                <!-- Am scos Antetul Rutei -->
                
                <!-- Cardul Opririi Curente (Locația e sus) -->
                <div class="bg-card-light dark:bg-card-dark rounded-2xl p-5 shadow-lg animate-slide-in" id="picking-stop-card">
                    <!-- Locația MARE -->
                    <div class="mb-4 text-center">
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Mergi la Locația:</h4>
                        <div class="text-3xl font-bold text-primary" id="stop-location">...</div>
                    </div>

                    <!-- Produsul -->
                    <div class="mb-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-2">Produs:</h4>
                        <div class="flex items-center space-x-3">
                            <div class="flex-1 text-2xl md:text-3xl font-mono font-bold text-text-light dark:text-text-dark truncate" id="stop-product-display" data-state="sku" data-sku="" data-name-ro="" data-name-en="">
                                ...
                            </div>
                            <button onclick="toggleProductDisplay(this)" class="p-2 rounded-full bg-gray-100 dark:bg-gray-800 text-text-light dark:text-text-dark">
                                <span class="material-icons-outlined">swap_horiz</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Cantitatea -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Cantitate de ridicat:</h4>
                        <div class="text-4xl font-bold text-primary" id="stop-quantity">...</div>
                    </div>
                </div>

                <!-- Butonul e mutat în footer-ul fix -->
            </div>

            <!-- Stare de finalizare -->
            <div id="picking-complete" class="hidden text-center p-8">
                <span class="material-icons-outlined text-8xl text-green-500">task_alt</span>
                <h2 class="text-2xl font-bold text-text-light dark:text-text-dark mt-4">Picking Finalizat!</h2>
                <p class="text-subtext-light dark:text-subtext-dark mt-2">Toate produsele au fost ridicate.</p>
                <button onclick="showPage('page-dashboard')" class="w-full bg-primary text-white font-bold py-4 rounded-xl mt-8">
                    Înapoi la Dashboard
                </button>
            </div>
            
            <!-- Footer fix pentru butonul de picking -->
            <div id="picking-footer" class="max-w-md mx-auto">
                 <button id="picking-next-button" onclick="advancePickingStop()" class="w-full bg-green-600 text-white font-bold py-5 rounded-2xl flex items-center justify-center space-x-2 text-xl shadow-lg">
                    <span class="material-icons-outlined">check_circle</span>
                    <span>Produs Ridicat</span>
                </button>
            </div>
        </div>

        <!-- PAGINA 5: Mută Produs (Nouă) -->
        <div id="page-move-product" class="page p-6 relative">
            <button onclick="showPage('page-dashboard')" class="absolute top-6 right-6 p-2 text-subtext-light dark:text-subtext-dark z-10">
                <span class="material-icons-outlined text-3xl">close</span>
            </button>
            
            <!-- Pasul 1: Scanare Produse (Interfață nouă) -->
            <div id="move-step-1-products" class="animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 1: Scanează Produsele</h2>
                <p class="text-subtext-light dark:text-subtext-dark mb-6 text-center">Scanează unul sau mai multe produse pe care vrei să le muți.</p>
                
                <!-- Lista de produse scanate -->
                <div id="move-product-list" class="space-y-2 mb-4 max-h-60 overflow-y-auto">
                    <!-- Produsele scanate vor fi injectate aici -->
                </div>

                <button onclick="startScanner('move_product')" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg shadow-primary/30 dark:shadow-glow-primary mb-4">
                    <span class="material-icons-outlined">qr_code_scanner</span>
                    <span>Scanează Produs (SKU)</span>
                </button>
                <button id="move-to-source-btn" onclick="goToMoveStep(2)" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg hidden">
                    <span>Selectează Sursele</span>
                    <span class="material-icons-outlined">arrow_forward</span>
                </button>
            </div>

            <!-- Pasul 2: Selectare Surse (Modificat pentru Multi-SKU) -->
            <div id="move-step-2-source" class="hidden animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 2: Selectează Sursele</h2>
                
                <p class="text-subtext-light dark:text-subtext-dark mb-4 text-center">Introdu cantitatea de mutat din fiecare locație:</p>
                
                <!-- Lista de locații sursă (grupate pe SKU) -->
                <div id="move-source-list" class="space-y-6 mb-6">
                    <!-- Locațiile vor fi injectate aici -->
                </div>
                
                <button onclick="goToMoveStep(3)" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg">
                    <span>Continuă</span>
                    <span class="material-icons-outlined">arrow_forward</span>
                </button>
                <button onclick="resetMoveFlow(false)" class="w-full text-center text-primary mt-6">
                    Rescanează Produsele
                </button>
            </div>

            <!-- Pasul 3: Scanare Destinație -->
            <div id="move-step-3-destination" class="hidden animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 3: Scanează Destinația</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-6 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Sumar de mutat:</p>
                    <div id="move-summary-text" class="text-text-light dark:text-text-dark font-semibold text-lg">...</div>
                </div>

                <p class="text-subtext-light dark:text-subtext-dark mb-6 text-center">Acum scanează codul QR al locației destinație.</p>
                <button onclick="startScanner('move_destination')" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg shadow-primary/30 dark:shadow-glow-primary">
                    <span class="material-icons-outlined">pin_drop</span>
                    <span>Scanează Locația Destinație</span>
                </button>
                <button onclick="goToMoveStep(2)" class="w-full text-center text-primary mt-6">
                    Modifică Sursele
                </button>
            </div>
            
            <!-- Pasul 4: Confirmare -->
            <div id="move-step-4-confirm" class="hidden animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 4: Confirmă Mutarea</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-5 rounded-2xl shadow-lg space-y-4">
                    <div>
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Produse:</h4>
                        <div id="move-confirm-product" class="text-lg font-bold text-text-light dark:text-text-dark">...</div>
                    </div>
                    <div>
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Cantitate Totală:</h4>
                        <div id="move-confirm-quantity" class="text-2xl font-bold text-primary">...</div>
                    </div>
                    <div>
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Din Locațiile:</h4>
                        <ul id="move-confirm-sources" class="text-sm text-text-light dark:text-text-dark list-disc list-inside">...</ul>
                    </div>
                    <div>
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Spre Locația:</h4>
                        <div id="move-confirm-destination" class="text-lg font-bold text-green-600">...</div>
                    </div>
                </div>

                <button onclick="saveMoveProduct()" class="w-full bg-green-600 text-white font-bold py-5 rounded-2xl flex items-center justify-center space-x-2 text-xl shadow-lg mt-8">
                    <span class="material-icons-outlined">check_circle</span>
                    <span>Confirmă Mutarea</span>
                </button>
                 <button onclick="resetMoveFlow(true)" class="w-full text-center text-primary mt-6">
                    Anulează
                </button>
            </div>
        </div>


    </div> <!-- Sfârșitul #app-container -->

    <!-- Bulă Notificare Comandă -->
    <div id="floating-order-bubble" class="hidden" onclick="showPage('page-picking')">
        <span class="material-icons-outlined">notifications_active</span>
        <span id="floating-order-count">0</span>
    </div>

    <!-- Footer Notificare Comandă (NOU) -->
    <div id="notification-footer" class="max-w-md mx-auto">
        <!-- Cardul de notificare mutat aici -->
        <div onclick="showPage('page-picking')" class="relative bg-primary rounded-2xl shadow-lg shadow-primary/30 dark:shadow-glow-primary overflow-hidden animate-slide-in cursor-pointer" id="order-notification">
            <div class="absolute -top-8 -right-8 w-32 h-32 bg-white/10 rounded-full"></div>
            <div class="absolute -bottom-12 -left-4 w-24 h-24 bg-white/10 rounded-full"></div>
            <div class="relative p-6 flex items-center space-x-4">
                <div class="flex-shrink-0 w-14 h-14 bg-white/20 rounded-full flex items-center justify-center">
                    <span class="material-icons-outlined text-white text-3xl">notifications_active</span>
                </div>
                <div>
                    <h2 class="text-lg font-bold text-white" id="order-notification-title-footer">Comenzi de pregătit</h2>
                    <p class="text-sm text-white/80" id="order-notification-text-footer">X comenzi așteaptă pregătirea.</p>
                </div>
                <button class="absolute top-3 right-3 p-1 text-white/60 hover:text-white transition-colors z-10" onclick="hideOrderNotification(event)">
                    <span class="material-icons-outlined text-xl">close</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal pentru Scaner QR -->
    <div id="scanner-modal">
        <div class="text-white text-lg p-4 text-center" id="scanner-message">Așezați codul QR în cadru</div>
        <div id="reader"></div>
        <button onclick="stopScanner()" class="mt-6 bg-red-600 text-white font-bold py-3 px-8 rounded-xl text-lg">
            Anulează
        </button>
    </div>

    <!-- Notificare Toast -->
    <div id="toast"></div>

    <!-- Overlay pentru încărcare (apel API) -->
    <div id="loading-overlay">
        <div class="spinner"></div>
    </div>


    <!-- Script-uri -->
    <script src="https://unpkg.com/html5-qrcode@2.0.9/dist/html5-qrcode.min.js"></script>
    <script src="app.js"></script>
</body>
</html>


<!DOCTYPE html>
<html class="dark" lang="ro">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>Manager Stocuri</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#007AFF",
                        "background-light": "#F3F4F6",
                        "background-dark": "#0B1117",
                        "card-light": "#FFFFFF",
                        "card-dark": "#161D26",
                        "text-light": "#111827",
                        "text-dark": "#E5E7EB",
                        "subtext-light": "#6B7280",
                        "subtext-dark": "#9CA3AF",
                    },
                    fontFamily: {
                        display: ["Sora", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "1rem",
                        "2xl": "1.5rem",
                        "3xl": "2rem",
                    },
                    boxShadow: {
                        'glow-primary': '0 0 20px 0px rgba(0, 122, 255, 0.4)',
                    }
                },
            },
        };
    </script>
    
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-background-light dark:bg-background-dark font-display antialiased">

    <div id="app-container" class="max-w-md mx-auto">
    
        <div id="page-dashboard" class="page active p-6">
            <header class="flex items-center justify-center py-4 relative">
                <h1 class="text-xl font-semibold text-text-light dark:text-text-dark">Depozit</h1>
            </header>

            <div id="search-zone" class="mb-6 mt-6">
                <div id="search-container">
                    <form id="search-form" class="dark:bg-card-dark shadow-sm" onsubmit="event.preventDefault();">
                        <span id="search-icon" class="material-icons-outlined">search</span>
                        <input type="text" id="search-input" placeholder="Caută produs..." class="dark:text-text-dark dark:placeholder-subtext-dark">
                    </form>
                </div>
                
                <button id="scan-find-button" onclick="startScanner('find')" class="w-full bg-primary text-white font-bold py-5 rounded-xl flex items-center justify-center space-x-2 text-lg mt-4 shadow-lg shadow-primary/30 dark:shadow-glow-primary transition-all duration-300">
                    <span class="material-icons-outlined">qr_code_scanner</span>
                    <span>Căută după QR</span>
                </button>

                <div id="find-results" class="space-y-4 mt-4 hidden">
                    </div>
            </div>

            <main id="main-cards" class="flex-grow flex flex-col space-y-5 mt-6">
                <a class="group block p-8 bg-card-light dark:bg-card-dark rounded-3xl transition-all duration-300 hover:scale-[1.03] hover:shadow-xl dark:hover:bg-card-dark/80" href="#" onclick="showPage('page-add-product')">
                    <div class="flex items-center space-x-6">
                        <div class="p-4 rounded-2xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center transition-colors">
                            <span class="material-icons-outlined text-4xl text-text-light dark:text-text-dark">add_location_alt</span>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-text-light dark:text-text-dark">Adaugă Produs</h3>
                            <p class="text-sm text-subtext-light dark:text-subtext-dark mt-1">Asociază un produs cu o locație</p>
                        </div>
                    </div>
                </a>
                
                <a class="group block p-8 bg-card-light dark:bg-card-dark rounded-3xl transition-all duration-300 hover:scale-[1.03] hover:shadow-xl dark:hover:bg-card-dark/80" href="#" onclick="showPage('page-delete-product')">
                    <div class="flex items-center space-x-6">
                        <div class="p-4 rounded-2xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center transition-colors">
                            <span class="material-icons-outlined text-4xl text-red-600 dark:text-red-400">delete_sweep</span>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-text-light dark:text-text-dark">Șterge Produs</h3>
                            <p class="text-sm text-subtext-light dark:text-subtext-dark mt-1">Șterge produse dintr-o locație</p>
                        </div>
                    </div>
                </a>
                </main>
        </div>

        <div id="page-find-product" class="page"></div>

        <div id="page-add-product" class="page p-6 relative">
<button onclick="handleCancelAddFlow()" class="absolute top-6 right-6 p-2 text-subtext-light dark:text-subtext-dark z-10">
    <span class="material-icons-outlined text-3xl">close</span>
</button>
            
            <div id="add-step-1-products" class="animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 1: Scanează Produsele</h2>
                <p class="text-subtext-light dark:text-subtext-dark mb-6 text-center">Scanează un produs pentru a-i adăuga cantitatea.</p>
                
                <div id="add-product-list" class="space-y-2 mb-4 max-h-60 overflow-y-auto">
                    </div>

                <button onclick="startScanner('product')" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg shadow-primary/30 dark:shadow-glow-primary mb-4">
                    <span class="material-icons-outlined">qr_code_scanner</span>
                    <span>Scanează Produs (SKU)</span>
                </button>
                <button id="add-to-location-btn" onclick="goToAddStep(2)" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg hidden">
                    <span>Mergi la Locație</span>
                    <span class="material-icons-outlined">arrow_forward</span>
                </button>
            </div>

            <div id="add-step-1b-quantity" class="hidden animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Setează Cantitatea</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-6 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Produs (SKU):</p>
                    <div id="add-quantity-sku" class="text-text-light dark:text-text-dark font-semibold text-lg font-mono">...</div>
                </div>
    
                <label for="add-quantity-input" class="block text-sm font-medium text-subtext-light dark:text-subtext-dark mb-2">Cantitate de adăugat:</label>
                <input type="number" id="add-quantity-input" value="1" min="1" class="w-full p-4 text-lg rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-text-dark text-center">
    
                <button onclick="confirmAddQuantity()" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg mt-6">
                    <span>Adaugă</span>
                    <span class="material-icons-outlined">check_circle</span>
                </button>
                <button onclick="goToAddStep(1)" class="w-full text-center text-primary mt-4">
                    Anulează
                </button>
            </div>
            <div id="add-step-2-location" class="hidden animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 2: Scanează Locația</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-6 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Produse de adăugat:</p>
                    <div id="add-product-summary" class="text-text-light dark:text-text-dark font-semibold text-lg">...</div>
                </div>

                <p class="text-subtext-light dark:text-subtext-dark mb-6 text-center">Acum scanează codul QR al locației (ex: "1,2,3").</p>
                <button onclick="startScanner('location')" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg shadow-primary/30 dark:shadow-glow-primary">
                    <span class="material-icons-outlined">pin_drop</span>
                    <span>Scanează Locație</span>
                </button>
                <button onclick="goToAddStep(1)" class="w-full text-center text-primary mt-6">
                    Modifică Produsele
                </button>
            </div>

            <div id="add-step-3-confirm" class="hidden animate-slide-in mt-8 flex flex-col h-full" style="min-height: 70vh;">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 3: Confirmă Adăugarea</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-4 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Produse:</p>
                    <ul id="add-confirm-list" class="text-text-light dark:text-text-dark font-semibold text-lg list-disc list-inside text-left p-2">
                        </ul>
                </div>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-6 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Locație:</p>
                    <div id="add-confirm-location" class="text-text-light dark:text-text-dark font-semibold text-lg">...</div>
                </div>

                <div class="flex-grow"></div>
                
                <div class="mt-auto pt-6">
                    <button onclick="saveMultiAdd()" class="w-full bg-green-600 text-white font-bold py-5 rounded-2xl flex items-center justify-center space-x-2 text-xl shadow-lg mb-4">
                        <span class="material-icons-outlined">check_circle</span>
                        <span>Salvează</span>
                    </button>
                    <div class="flex space-x-4">
                         <button onclick="goToAddStep(2)" class="w-full text-center text-primary py-2">
                            Schimbă Locația
                        </button>
                        <button onclick="goToAddStep(1)" class="w-full text-center text-primary py-2">
                            Modifică Produsele
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-picking" class="page p-6 relative">
            <header class="flex items-center justify-end py-4 relative">
                <button onclick="showPage('page-dashboard')" class="p-2 text-subtext-light dark:text-subtext-dark z-10">
                    <span class="material-icons-outlined text-3xl">close</span>
                </button>
            </header>
            
            <div id="picking-content">
                <div class="bg-card-light dark:bg-card-dark rounded-2xl p-5 shadow-lg animate-slide-in" id="picking-stop-card">
                    <div class="mb-4 text-center">
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Mergi la Locația:</h4>
                        <div class="text-3xl font-bold text-primary" id="stop-location">...</div>
                    </div>

                    <div class="mb-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-2">Produs:</h4>
                        <div class="flex items-center space-x-3">
                            <div class="flex-1 text-2xl md:text-3xl font-mono font-bold text-text-light dark:text-text-dark truncate" id="stop-product-display" data-state="sku" data-sku="" data-name-ro="" data-name-en="">
                                ...
                            </div>
                            </div>
                    </div>
                    
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Cantitate de ridicat:</h4>
                        <div class="text-4xl font-bold text-primary" id="stop-quantity">...</div>
                    </div>
                </div>

                </div>

            <div id="picking-complete" class="hidden text-center p-8">
                <span class="material-icons-outlined text-8xl text-green-500">task_alt</span>
                <h2 class="text-2xl font-bold text-text-light dark:text-text-dark mt-4">Picking Finalizat!</h2>
                <p class="text-subtext-light dark:text-subtext-dark mt-2">Toate produsele au fost ridicate.</p>
                <button onclick="showPage('page-dashboard')" class="w-full bg-primary text-white font-bold py-4 rounded-xl mt-8">
                    Înapoi la Dashboard
                </button>
            </div>
            
            <div id="picking-footer" class="max-w-md mx-auto">
                 <button id="picking-next-button" onclick="advancePickingStop()" class="w-full bg-green-600 text-white font-bold py-5 rounded-2xl flex items-center justify-center space-x-2 text-xl shadow-lg">
                    <span class="material-icons-outlined">check_circle</span>
                    <span>Produs Ridicat</span>
                </button>
                <button id="picking-skip-button" onclick="skipPickingStop()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 rounded-2xl flex items-center justify-center space-x-2 text-lg shadow-lg mt-3">
                    <span class="material-icons-outlined">skip_next</span>
                    <span>Amană (Treci la Următorul)</span>
                </button>
                </div>
        </div>

        <div id="page-delete-product" class="page p-6 relative">
            <button onclick="showPage('page-dashboard')" class="absolute top-6 right-6 p-2 text-subtext-light dark:text-subtext-dark z-10">
                <span class="material-icons-outlined text-3xl">close</span>
            </button>
            
            <div id="delete-step-1-products" class="animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 1: Scanează Produsele</h2>
                <p class="text-subtext-light dark:text-subtext-dark mb-6 text-center">Scanează un produs pentru a-i seta cantitatea de șters.</p>
                
                <div id="delete-product-list" class="space-y-2 mb-4 max-h-60 overflow-y-auto">
                    </div>

                <button onclick="startScanner('delete_product')" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg shadow-primary/30 dark:shadow-glow-primary mb-4">
                    <span class="material-icons-outlined">qr_code_scanner</span>
                    <span>Scanează Produs (SKU)</span>
                </button>
                <button id="delete-to-location-btn" onclick="goToDeleteStep(2)" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg hidden">
                    <span>Scanează Locația</span>
                    <span class="material-icons-outlined">arrow_forward</span>
                </button>
            </div>

            <div id="delete-step-1b-quantity" class="hidden animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Setează Cantitatea de Șters</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-6 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Produs (SKU):</p>
                    <div id="delete-quantity-sku" class="text-text-light dark:text-text-dark font-semibold text-lg font-mono">...</div>
                </div>
    
                <label for="delete-quantity-input" class="block text-sm font-medium text-subtext-light dark:text-subtext-dark mb-2">Cantitate de șters:</label>
                <input type="number" id="delete-quantity-input" value="1" min="1" class="w-full p-4 text-lg rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-text-dark text-center">
    
                <button onclick="confirmDeleteQuantity()" class="w-full bg-red-600 text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg mt-6">
                    <span>Setează Cantitatea</span>
                    <span class="material-icons-outlined">check_circle</span>
                </button>
                <button onclick="goToDeleteStep(1)" class="w-full text-center text-primary mt-4">
                    Anulează
                </button>
            </div>
            <div id="delete-step-2-location" class="hidden animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 2: Scanează Locația</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl mb-6 text-center">
                    <p class="text-sm text-subtext-light dark:text-subtext-dark">Sumar de șters:</p>
                    <div id="delete-summary-text" class="text-text-light dark:text-text-dark font-semibold text-lg">...</div>
                </div>

                <p class="text-subtext-light dark:text-subtext-dark mb-6 text-center">Acum scanează codul QR al locației de pe care vrei să ștergi.</p>
                <button onclick="startScanner('delete_location')" class="w-full bg-primary text-white font-bold py-4 rounded-xl flex items-center justify-center space-x-2 text-lg shadow-lg shadow-primary/30 dark:shadow-glow-primary">
                    <span class="material-icons-outlined">pin_drop</span>
                    <span>Scanează Locația</span>
                </button>
                <button onclick="goToDeleteStep(1)" class="w-full text-center text-primary mt-6">
                    Modifică Produsele
                </button>
            </div>
            
            <div id="delete-step-3-confirm" class="hidden animate-slide-in mt-8">
                <h2 class="text-xl font-semibold text-text-light dark:text-text-dark mb-4 text-center">Pasul 3: Confirmă Ștergerea</h2>
                
                <div class="bg-card-light dark:bg-card-dark p-5 rounded-2xl shadow-lg space-y-4">
                    <div>
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Produse (SKU):</h4>
                        <div id="delete-confirm-product" class="text-lg font-bold text-text-light dark:text-text-dark">...</div>
                    </div>
                    <div>
                        <h4 class="text-sm font-semibold text-subtext-light dark:text-subtext-dark mb-1">Din Locația:</h4>
                        <div id="delete-confirm-location" class="text-lg font-bold text-red-600">...</div>
                    </div>
                </div>

                <button onclick="saveDeleteProduct()" class="w-full bg-red-600 text-white font-bold py-5 rounded-2xl flex items-center justify-center space-x-2 text-xl shadow-lg mt-8">
                    <span class="material-icons-outlined">delete_forever</span>
                    <span>Confirmă Ștergerea</span>
                </button>
                 <button onclick="resetDeleteFlow(true)" class="w-full text-center text-primary mt-6">
                    Anulează
                </button>
            </div>
        </div>
        </div> 
    
    <div id="floating-order-bubble" class="hidden" onclick="showPage('page-picking')">
        <span class="material-icons-outlined">notifications_active</span>
        <span id="floating-order-count">0</span>
    </div>

    <div id="notification-footer" class="max-w-md mx-auto">
        <div onclick="showPage('page-picking')" class="relative bg-primary rounded-2xl shadow-lg shadow-primary/30 dark:shadow-glow-primary overflow-hidden animate-slide-in cursor-pointer" id="order-notification">
            <div class="absolute -top-8 -right-8 w-32 h-32 bg-white/10 rounded-full"></div>
            <div class="absolute -bottom-12 -left-4 w-24 h-24 bg-white/10 rounded-full"></div>
            <div class="relative p-6 flex items-center space-x-4">
                <div class="flex-shrink-0 w-14 h-14 bg-white/20 rounded-full flex items-center justify-center">
                    <span class="material-icons-outlined text-white text-3xl">notifications_active</span>
                </div>
                <div>
                    <h2 class="text-lg font-bold text-white" id="order-notification-title-footer">Comenzi de pregătit</h2>
                    <p class="text-sm text-white/80" id="order-notification-text-footer">X comenzi așteaptă pregătirea.</p>
                </div>
                <button class="absolute top-3 right-3 p-1 text-white/60 hover:text-white transition-colors z-10" onclick="hideOrderNotification(event)">
                    <span class="material-icons-outlined text-xl">close</span>
                </button>
            </div>
        </div>
    </div>

    <div id="scanner-modal">
        <div class="text-white text-lg p-4 text-center" id="scanner-message">Așezați codul QR în cadru</div>
        <video id="qr-video" style="width: 90%; max-width: 400px; border-radius: 1rem;"></video>
        <button onclick="stopScanner()" class="mt-6 bg-red-600 text-white font-bold py-3 px-8 rounded-xl text-lg">
            Anulează
        </button>
    </div>

    <div id="toast"></div>

    <div id="loading-overlay">
        <div class="spinner"></div>
    </div>

<script type="module" src="scripts/state.js"></script>
    <script type="module" src="scripts/utils.js"></script>
    <script type="module" src="scripts/api.js"></script>
    <script type="module" src="scripts/scanner.js"></script> 
    <script type="module" src="scripts/flow-search.js"></script>
    <script type="module" src="scripts/flow-add.js"></script>
    <script type="module" src="scripts/flow-delete.js"></script>
    <script type="module" src="scripts/flow-picking.js"></script>
    <script type="module" src="scripts/main.js"></script>
</body>
</html>
